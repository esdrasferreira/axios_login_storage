<!DOCTYPE HTML>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="author" content="Bootstrap-ecommerce by Vosidiy">

    <title>UI KIT - Marketplace and Ecommerce html template</title>

    <link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico">

    <!-- jQuery -->
    <script src="js/jquery-2.0.0.min.js" type="text/javascript"></script>

    <!-- Bootstrap4 files-->
    <script src="js/bootstrap.bundle.min.js" type="text/javascript"></script>
    <link href="css/bootstrap.css" rel="stylesheet" type="text/css" />

    <!-- Font awesome 5 -->
    <link href="fonts/fontawesome/css/fontawesome-all.min.css" type="text/css" rel="stylesheet">

    <!-- plugin: fancybox  -->
    <script src="plugins/fancybox/fancybox.min.js" type="text/javascript"></script>
    <link href="plugins/fancybox/fancybox.min.css" type="text/css" rel="stylesheet">

    <!-- plugin: owl carousel  -->
    <link href="plugins/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="plugins/owlcarousel/assets/owl.theme.default.css" rel="stylesheet">
    <script src="plugins/owlcarousel/owl.carousel.min.js"></script>

    <!-- custom style -->
    <link href="css/ui.css" rel="stylesheet" type="text/css" />
    <link href="css/responsive.css" rel="stylesheet" media="only screen and (max-width: 1200px)" />

    <!-- custom javascript -->
    <script src="js/script.js" type="text/javascript"></script>
    <!--  axyos javascript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.min.js"></script>

    <script type="text/javascript">
        /// some script

        // jquery ready start
        $(document).ready(function () {
            // jQuery code

        });
// jquery end
    </script>


</head>

<body>

    <div id="header">


        <header class="section-header">
            <nav class="navbar navbar-top navbar-expand-lg navbar-dark bg-secondary">
                <div class="container">
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample07"
                        aria-controls="navbarsExample07" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse" id="navbarsExample07">
                        <ul class="navbar-nav mr-auto">
                            <li><a href="#" class="nav-link"> <i class="fab fa-facebook"></i> </a></li>
                            <li><a href="#" class="nav-link"> <i class="fab fa-instagram"></i> </a></li>
                            <li><a href="#" class="nav-link"> <i class="fab fa-twitter"></i> </a></li>
                        </ul>
                        <ul class="navbar-nav">
                            <li class="nav-item"><a href="#" class="nav-link"> Delivery </a></li>
                            <li class="nav-item"><a href="#" class="nav-link"> Help </a></li>
                            <li class="nav-item dropdown"><a href="#" class="nav-link dropdown-toggle"
                                    data-toggle="dropdown"> USD </a>
                                <ul class="dropdown-menu dropdown-menu-right">
                                    <li><a class="dropdown-item" href="#">EUR</a></li>
                                    <li><a class="dropdown-item" href="#">AED</a></li>
                                    <li><a class="dropdown-item" href="#">RUBL </a></li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown"><a href="#" class="nav-link dropdown-toggle"
                                    data-toggle="dropdown"> Language </a>
                                <ul class="dropdown-menu dropdown-menu-right">
                                    <li><a class="dropdown-item" href="#">English</a></li>
                                    <li><a class="dropdown-item" href="#">Arabic</a></li>
                                    <li><a class="dropdown-item" href="#">Russian </a></li>
                                </ul>
                            </li>
                        </ul> <!-- navbar-nav.// -->
                    </div> <!-- collapse.// -->
                </div>
            </nav>

            <section class="header-main shadow-sm">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-lg-3 col-sm-4">
                            <div class="brand-wrap">
                                <img class="logo" src="images/logo-dark.png">
                                <h2 class="logo-text">LOGO</h2>
                            </div> <!-- brand-wrap.// -->
                        </div>
                        <div class="col-lg-4 col-xl-5 col-sm-8" id="search">
                            <form action="#" class="search-wrap">
                                <div class="input-group w-100">
                                    <input type="text" class="form-control" style="width:55%;" placeholder="Search">
                                    <select class="custom-select" name="category_name">
                                        <option value="">All type</option>
                                        <option value="codex">Special</option>
                                        <option value="comments">Only best</option>
                                        <option value="content">Latest</option>
                                    </select>
                                    <div class="input-group-append">
                                        <button class="btn btn-primary" type="submit">
                                            <i class="fa fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                            </form> <!-- search-wrap .end// -->
                        </div> <!-- col.// -->
                        <div class="col-lg-5 col-xl-4 col-sm-12">
                            <div class="widgets-wrap float-right">
                                <a href="#" class="widget-header mr-3" id="cart">
                                    <div class="icontext">
                                        <div class="icon-wrap" id="icon1"><i
                                                class="icon-sm round border fa fa-shopping-cart"></i>
                                        </div>
                                        <div class="text-wrap">
                                            <span class="small badge badge-danger">0</span>
                                            <div>Cart</div>
                                        </div>
                                    </div>
                                </a>
                                <!----> <a href="#" class="widget-header mr-3" id="produtos">
                                    <div class="icontext">
                                        <div class="icon-wrap"><i class="icon-sm round border fa fa-heart"></i>
                                        </div>
                                        <div class="text-wrap">
                                            <small>Wish</small>
                                            <div>List</div>
                                        </div>
                                    </div>
                                </a>
                                <div class="widget-header dropdown">
                                    <a href="#" data-toggle="dropdown" data-offset="20,10">
                                        <div class="icontext">
                                            <div class="icon-wrap"><i class="icon-sm round border fa fa-user"></i>
                                            </div>
                                            <div class="text-wrap">
                                                <small id="small">Logar | Cadastrar</small>
                                                <div>My account <i class="fa fa-caret-down"></i> </div>
                                            </div>
                                        </div>
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-right" id="drop">
                                        <!--Inicio Login ------------------------------------------------------------------------------------------------------------------>
                                        <form class="px-4 py-3" id="form-login">
                                            <div class="form-group" id="div-login">
                                                <label id="label-login">Usuario:</label>
                                                <input type="text" class="form-control" placeholder="" id="login">
                                            </div>
                                            <div class="form-group" id="div-senha">
                                                <label id="label-senha">Senha</label>
                                                <input type="text" class="form-control" placeholder="" id="senha">
                                            </div>
                                            <button type="submit" class="btn btn-primary" id="logar">Logar</button>
                                        </form>
                                        <!--FIM Login ------------------------------------------------------------------------------------------------------------------->
                                        <hr class="dropdown-divider">
                                        <a class="dropdown-item" id="logout" href="#">Logout</a>
                                        <a class="dropdown-item" id="cadastro" href="#">Cadastre-se</a>
                                    </div> <!--  dropdown-menu .// -->
                                </div> <!-- widget-header .// -->
                            </div> <!-- widgets-wrap.// -->
                        </div> <!-- col.// -->
                    </div> <!-- row.// -->
                </div> <!-- container.// -->
            </section> <!-- header-main .// -->
        </header> <!-- section-header.// -->
    </div>
    <!--------------FIM DIV HEADER---------------------------->

    <div id="resultado"></div>


    <script type="module">
        import { Produto } from "./produto.js";

        document.getElementById('logout').addEventListener('click', () => {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.assign('login try.html');   //direcionamento do link logout
        })

        var data = {};

        document;
        // window.addEventListener("load", () => montaTela());

        const createTable = () => {
            let element = document.createElement("table");
            element.className = "table table-striped table-dark";
            element.id = "tabela";
            element.border = "1";
            element.appendChild(tableHead());

            return element;
        };

        const tableBody = () => {
            let tableBody = document.createElement("tbody");
        };

        const tableHead = () => {
            let thead1 = document.createElement("thead");
            thead1.className = "thead-dark";
            let tr1 = document.createElement("tr");
            let th1 = document.createElement("th");
            th1.scope = "col";
            th1.innerHTML = "ID";
            let th2 = document.createElement("th");
            th2.scope = "col";
            th2.innerHTML = "Produtos";
            let th3 = document.createElement("th");
            th3.scope = "col";
            th3.innerHTML = "Atualizar";
            let th4 = document.createElement("th");
            th4.scope = "col";
            th4.innerHTML = "Deletar";
            tr1.appendChild(th1);
            tr1.appendChild(th2);
            tr1.appendChild(th3);
            tr1.appendChild(th4);
            thead1.appendChild(tr1);

            return thead1;
        };

        const createTr = () => {
            const tr = document.createElement("tr");
            return tr;
        };

        const createButtonUpdate = categoria => {
            const element = document.createElement("button");
            element.id = `button-${categoria.id}`;
            element.className = "btn btn-primary";
            element.innerHTML = "Atualizar";
            element.addEventListener("click", () => {
                recriateTable(); //recria tudo novamente, usando o cache
                changeButton(categoria.id); //muda o botão
                changeToField(categoria); //cria o campo de texto
            });

            return element;
        };

        const createButtonDelete = categoria => {
            const element = document.createElement("button");
            element.id = `button-${categoria.id}`;
            element.className = "btn btn-danger";
            element.innerHTML = "Deletar";
            element.addEventListener("click", () => {
                deletar(categoria.id);
                recriateTable(); //recria tudo novamente, usando o cache
            });

            return element;
        };

        const recriateTable = () => {
            let resultado = document.getElementById("resultado");
            resultado.innerHTML = ""; //limpa

            appendToDOM(data);
        };

        const formElement = () => {
            const element = document.createElement("form");
            element.action = "#";
            element.id = "formulario";
            element.addEventListener("submit", () => alert("enviou"));
            return element;
        };

        const changeToField = categoria => {
            const element = document.getElementById(`id-${categoria.id}`);
            element.innerHTML = ""; //limpa o atual
            element.appendChild(textField(categoria.nome)); //adiciona o novo
        };

        const fieldValue = () => {
            return document.getElementById("nome").value;
        };

        const deletar = async id => {
            let categoria = new Categoria();
            let resultado = await categoria.deletar(id);

            for (let i = 0; i < data.length; i++) {
                if (data[i].id === id) {
                    data[i].splice(i, 1);
                }
            }
        };

        const atualiza = async id => {
            const campoNome = document.getElementById("nome").value;
            let objeto = {};
            objeto.nome = campoNome;
            objeto.id = id;
            let categoria = new Categoria();
            let resultado = await categoria.atualizar(objeto);

            /* itera dentro de data e quando encontra o id atualiza o data[i].nome para campoNome*/

            for (let i = 0; i < data.length; i++) {
                if (data[i].id === id) {
                    data[i].nome = campoNome;
                }
            }
            /* **************************************************************/
            if (resultado.data.editado) {
                recriateTable(); //chama o cache e ele não esta atualizado
            }
        };

        const changeButton = id => {
            const td = document.getElementById(`btn-${id}`);
            td.innerHTML = ""; //limpa
            const element = document.createElement("button");
            element.id = `upbutton-${id}`;
            element.className = "btn btn-warning";
            element.innerHTML = "Confirmar";
            element.addEventListener("click", () => atualiza(id));
            td.appendChild(element);
        };

        const textField = content => {
            const element = document.createElement("input");
            element.id = "nome";
            element.value = content;
            return element;
        };

        const createTdTr = categoria => {
            const tr = createTr();

            const td1 = document.createElement("td");
            td1.className = "classname";
            td1.innerHTML = `${categoria.id}`;

            const td2 = document.createElement("td");
            td2.id = `id-${categoria.id}`;
            td2.className = "classname";
            td2.innerHTML = `${categoria.nome}`;

            const td3 = document.createElement("td");
            td3.id = `btn-${categoria.id}`;
            td3.className = "classname";
            td3.appendChild(createButtonUpdate(categoria));

            const td4 = document.createElement("td");
            td4.id = `btn-${categoria.id}`;
            td4.className = "classname";
            td4.appendChild(createButtonDelete(categoria));

            tr.appendChild(td1);
            tr.appendChild(td2);
            tr.appendChild(td3);
            tr.appendChild(td4);

            return tr;
        };

        const appendToDOM = categorias => {
            document.getElementById('resultado').innerHTML = "";
            const resultado = document.getElementById("resultado");
            const table = createTable();

            categorias.map(categoria => {
                table.appendChild(createTdTr(categoria));
            });

            resultado.appendChild(table);
        };

        var montaTela = async () => {

            let token = localStorage.getItem('token')
            console.log(token)
            if (token == null) {
                window.location.assign('login.html')
            }

            try {


                let produto = new Produto();

                let resposta = await produto.getProdutos(token);
                let output = resposta;

                console.log(resposta)


                if (resposta.data != null && resposta.data.rows.length > 0) {
                    output = ""
                    data = resposta.data.rows;

                    appendToDOM(data);
                } else {
                    document.getElementById("resultado").innerHTML = output;
                }

            } catch (error) {
                document.getElementById("resultado").innerHTML = 'Erro na recuperação dos produtos';
            }



        };

        var montaTelaLogin = () => {
            document.getElementById('drop').classList.remove("show");

            document.getElementById('cart').innerHTML = "";
            document.getElementById('cart').innerHTML =


                ` <div class="icontext">` +
                `<div class="icon-wrap" id="icon1">` +

                `</div>` +
                `<div class="text-wrap">` +

                `<div>Categorias</div>` +
                `</div>` +
                `</div>`
                ;

            document.getElementById('produtos').innerHTML = "";
            document.getElementById('produtos').innerHTML =
                ` <div class="icontext">` +
                `<div class="icon-wrap" id="icon1">` +

                `</div>` +
                `<div class="text-wrap">` +

                `<div>Produtos</div>` +
                `</div>` +
                `</div>`
                ;
            ;

            document.getElementById('form-login').innerHTML = "";
            document.getElementById('cadastro').innerHTML = "";




            document.getElementById('small').innerHTML = localStorage.getItem('user') + " logado";

            document.getElementById('produtos').addEventListener('click', () => {

                montaTela();
            })
            document.getElementById('cart').addEventListener('click', () => {

                montaTelaCategoria();
            })


        }


        document.getElementById('logout').addEventListener('click', () => {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.assign('login try.html');
        })

        document.getElementById('cadastro').addEventListener('click', () => {
            document.getElementById('label-login').innerHTML = "Preencha novo usuário aqui: ";
            document.getElementById('label-senha').innerHTML = "Cadastre a nova senha aqui: ";
            document.getElementById('logar').innerHTML = 'Cadastrar'
            document.getElementById('logar').id = 'cadastrar'


        })
        document.getElementById('logar').addEventListener('click', () => cadastro(event));
        var cadastro = async (event) => {
            event.preventDefault();
            let user = new Usuario;
            let login = document.getElementById('login').value;
            let senha = document.getElementById('senha').value;
            try {
                let resposta = await user.cadastrar(login, senha);
                console.log(resposta)

                montaTelaLogin();

                // window.location.assign("produtos.html") //assing permite voltar a pagina e manter histório



            } catch (error) {
                console.log(error);
            }


        }

        import { Usuario } from './usuario.js';

        document.getElementById('logar').addEventListener('click', () => logar(event));

        var logar = async (event) => {
            event.preventDefault();

            let user = new Usuario;
            let login = document.getElementById('login').value;
            let senha = document.getElementById('senha').value;

            try {
                let resposta = await user.login(login, senha);
                console.log(resposta)

                let token = resposta.data['access-token']
                localStorage.setItem('token', token)
                localStorage.setItem('user', login)
                montaTelaLogin();
                // window.location.assign("produtos.html") //assing permite voltar a pagina e manter histório



            } catch (error) {
                // document.getElementById('resultado').innerHTML = 'Login ou Senha inválidos';
            }


        }

        /* INICIO MONTA TELA CATEGORIA*/
        import { Categoria } from "./categoria.js";

        var data = {};

        document;


        const createTable2 = () => {
            let element = document.createElement("table");
            element.className = "table table-striped table-dark";
            element.id = "tabela";
            element.border = "1";
            element.appendChild(tableHead2());

            return element;
        };

        const tableBody2 = () => {
            let tableBody = document.createElement("tbody");
        };

        const tableHead2 = () => {
            let thead1 = document.createElement("thead");
            thead1.className = "thead-dark";
            let tr1 = document.createElement("tr");
            let th1 = document.createElement("th");
            th1.scope = "col";
            th1.innerHTML = "ID";
            let th2 = document.createElement("th");
            th2.scope = "col";
            th2.innerHTML = "Categorias";
            let th3 = document.createElement("th");
            th3.scope = "col";
            th3.innerHTML = "Atualizar";
            let th4 = document.createElement("th");
            th4.scope = "col";
            th4.innerHTML = "Deletar";
            tr1.appendChild(th1);
            tr1.appendChild(th2);
            tr1.appendChild(th3);
            tr1.appendChild(th4);
            thead1.appendChild(tr1);

            return thead1;
        };

        const createTr2 = () => {
            const tr = document.createElement("tr");
            return tr;
        };

        const createButtonUpdate2 = categoria => {
            const element = document.createElement("button");
            element.id = `button-${categoria.id}`;
            element.className = "btn btn-primary";
            element.innerHTML = "Atualizar";
            element.addEventListener("click", () => {
                recriateTable2(); //recria tudo novamente, usando o cache
                changeButton2(categoria.id); //muda o botão
                changeToField2(categoria); //cria o campo de texto
            });

            return element;
        };

        const createButtonDelete2 = categoria => {
            const element = document.createElement("button");
            element.id = `button-${categoria.id}`;
            element.className = "btn btn-danger";
            element.innerHTML = "Deletar";
            element.addEventListener("click", () => {
                deletar2(categoria.id);
                recriateTable2(); //recria tudo novamente, usando o cache
            });

            return element;
        };

        const recriateTable2 = () => {
            let resultado = document.getElementById("resultado");
            resultado.innerHTML = ""; //limpa

            appendToDOM2(data);
        };

        const formElement2 = () => {
            const element = document.createElement("form");
            element.action = "#";
            element.id = "formulario";
            element.addEventListener("submit", () => alert("enviou"));
            return element;
        };

        const changeToField2 = categoria => {
            const element = document.getElementById(`id-${categoria.id}`);
            element.innerHTML = ""; //limpa o atual
            element.appendChild(textField2(categoria.nome)); //adiciona o novo
        };

        const fieldValue2 = () => {
            return document.getElementById("nome").value;
        };

        const deletar2 = async id => {
            let categoria = new Categoria();
            let resultado = await categoria.deletar(id);

            for (let i = 0; i < data.length; i++) {
                if (data[i].id === id) {
                    data[i].splice(i, 1);
                }
            }
        };

        const atualiza2 = async id => {
            const campoNome = document.getElementById("nome").value;
            let objeto = {};
            objeto.nome = campoNome;
            objeto.id = id;
            let categoria = new Categoria();
            let resultado = await categoria.atualizar(objeto);

            /* itera dentro de data e quando encontra o id atualiza o data[i].nome para campoNome*/

            for (let i = 0; i < data.length; i++) {
                if (data[i].id === id) {
                    data[i].nome = campoNome;
                }
            }
            /* **************************************************************/
            if (resultado.data.editado) {
                recriateTable2(); //chama o cache e ele não esta atualizado
            }
        };

        const changeButton2 = id => {
            const td = document.getElementById(`btn-${id}`);
            td.innerHTML = ""; //limpa
            const element = document.createElement("button");
            element.id = `upbutton-${id}`;
            element.className = "btn btn-warning";
            element.innerHTML = "Confirmar";
            element.addEventListener("click", () => atualiza(id));
            td.appendChild(element);
        };

        const textField2 = content => {
            const element = document.createElement("input");
            element.id = "nome";
            element.value = content;
            return element;
        };

        const createTdTr2 = categoria => {
            const tr = createTr2();

            const td1 = document.createElement("td");
            td1.className = "classname";
            td1.innerHTML = `${categoria.id}`;

            const td2 = document.createElement("td");
            td2.id = `id-${categoria.id}`;
            td2.className = "classname";
            td2.innerHTML = `${categoria.nome}`;

            const td3 = document.createElement("td");
            td3.id = `btn-${categoria.id}`;
            td3.className = "classname";
            td3.appendChild(createButtonUpdate2(categoria));

            const td4 = document.createElement("td");
            td4.id = `btn-${categoria.id}`;
            td4.className = "classname";
            td4.appendChild(createButtonDelete2(categoria));

            tr.appendChild(td1);
            tr.appendChild(td2);
            tr.appendChild(td3);
            tr.appendChild(td4);

            return tr;
        };

        const appendToDOM2 = categorias => {
            document.getElementById('resultado').innerHTML = "";
            const resultado = document.getElementById("resultado");
            const table = createTable2();

            categorias.map(categoria => {
                table.appendChild(createTdTr2(categoria));
            });

            resultado.appendChild(table);
        };

        var montaTelaCategoria = async () => {

            let categoria = new Categoria();
            let resposta = await categoria.getCategorias();
            let output = resposta;
            if (resposta.data != null && resposta.data.length > 0) {
                data = resposta.data;

                appendToDOM2(data);
            } else {
                document.getElementById("resultado").innerHTML = output;
            }
        };

        /* FIM MONTA TELA CATEGORIA*/

    </script>






</body>

</html>